# Notes

1. Let's try to make it as generic as possible. So it would be the client responsibility to display it correctly.
   1. We should go into attributes / options approach instead of defining size and color on product itself
   2. Each variant should have a price and SKU
   3. Variants should be connected by some parent (for example T-Shirt has one name and description but multiple sizes
      and colors)
   4. Some variants could be out of stock or more expensive
2. Description should be markdown
   1. And support custom components (for example for creating drop-downs)
3. General Idea:
   1. Headless approach
   2. Tenant support
   3. 1st app - API for shop, so you can create your own shops - GraphQL using yoga
   4. 2nd app - actual store implementation using NextJS
   5. 3rd app - Admin panel for managing products, orders, customers, etc. - some web app with REST. Admin panel with xhtml.
   6. 4th app - Landing page - Astro ???
   7. AI Support - generating images and descriptions for products etc.

# Technical:

- [x] Reusable PriceMapper
- [x] Handle nulls better in Product price (do not allow `!` in general)
- [x] Move db schema closer to the modules
- [x] Introduce HashID as a resolver for ID scalar
- [x] Github
- [ ] Fly.io
  - [ ] Database setup - Neon
  - [ ] Add migration task
- [x] Handle errors generically (for example do not throw "Not found" string)
- [ ] Add linter for graphql and TS
- [ ] Separate product definition from the product in list. So you can have different model for management API and different when fetching via GraphQL
- [ ] Better createdAt / updatedAt handling
- [ ] How to test this shit?
- [ ] Seed
  - [ ] Never ends after adding product attributes
  - [ ] Should be more manageable and structured
- [ ] Run prettier and linter **only** on generated by codegen files
- [ ] Data Loader for batching queries or something
- [ ] Consider price as graphql-scalar
- [ ] Consider using effect TS
- [ ] Add somehow those limits on graphql API - so no one create infinite n+1 queries
- [ ] MonoRepo
- [ ] Do I want to add headless component library with typical components for shop?
  - [ ] Filters
  - [ ] Categories
  - [ ] Product etc.
  - [ ] shadcn style

# API

Products:

- base
  - [x] query by slug
  - [x] paginated list of products
  - [x] host assets somewhere
  - [x] product - show assets
  - [x] attributes abstraction
    - [x] schema
    - [x] graphql
  - [x] product variants
    - [x] overrides specific attributes
    - [x] original product is variant for the variant
- [ ] categories
  - [x] products from category
  - [x] categories can be nested (max 3 or something)
  - [x] product can be part of many categories
  - [ ] similar products - based on same categories
- [ ] search
  - [ ] psql gindex
  - [ ] allow to sort
- [ ] assets management
  - [ ] ordering
  - [ ] title / alt text
  - [ ] hidden
  - [ ] thumbnail (always first asset or mark it somehow)
- [ ] improvements
  - [ ] hashid should be scoped by graphql type (for example Product should become a seed for it)
  - [ ] should dbClient be taken from the context instead of imported directly?
  - [ ] attributes, variants and other relationships - they should be joined and fetched only when requested. Maybe use info object for that. Can it be improved by data loader?
  - [ ] I definitely have to take a look into data loaders to not do n+1 queries all the time
  - [ ] Why I always have to define all fields (even non transformed) in resolvers?
  - [ ] improve validation -> args should go through zed or other validation lib
  - [ ] categories
    - [ ] products should be paginated
    - [ ] products fetched from category should also include products from all subcategories (or at least we should have such option)
  - [ ] pagination
    - [ ] Make cursor a scalar
      - [ ] It shouldn't use raw ids otherwise hashid implementation doesn't have sense
      - [ ] Include sorts in cursor
    - [ ] better isLastPage calculation (needs to include count for all or something)
    - [ ] make sure it is all paginated - we need to support multiple cursors https://medium.com/@george_16060/cursor-based-pagination-with-arbitrary-ordering-b4af6d5e22db
  - [ ] There should be separation between product in management and product in shop. Management has current variants sturcture etc. and after it is saved all variants are generated updated. Otherwise calculations become too complex
    - [ ] this should simplify resolvers for Product and ProductVariant
    - [ ] ProductVariant should return all attributes, not only the ones that are overridden by the variant
    - [ ] Variant should not have separate category set -> another argument to move it out of the product table?
  - [ ] Different file structure
    - [ ] graphql should be separate layer
    - [ ] either core / domain has separate layer or graphql resolvers are separated from the domain / core / db
  - [ ] graphql practices
    - [ ] Should I always use edge when returning list of items? For example check Category model
- [ ] auth
  - [ ] clerk?
  - [ ] multi tenancy
- [ ] basket
  - [ ] redis?
- [ ] checkout
  - [ ] stripe?
- [ ] Example shop site built with the API (NextJS)
- [ ] Management project (NextJS)
  - [ ] With tutorial
  - [ ] Product attributes - configuration, serialization, deserialization, validation. Make sure that updates are propagated (or not) across all created products
  - [ ] Product template - so you can define attributes only once
  - [ ] Templates (for example shop with clotches -> automatically defines categories, attributes etc.)
  - [ ] Asset validation (no nudity etc.)
- [ ] For the future
  - [ ] stock - quantity, SKU etc.
  - [ ] Categories will (and actually everything returned to the store) will require some metadata
- Ideas:
  - [ ] MultiLanguage
  - [ ] upsell others - bought together. Based on statistics
  - [ ] Similar products - based on machine learning
  - [ ] dedicated db for search (mantine or something)
- Tooling:
  - [ ] Dependabot / RenovateBot
  - [ ] Some AI powered code reviews for Github
  - [ ] Code audits
